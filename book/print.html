<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Documentation on using HPC and containers for Machine Learning</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Preliminary comments</a></li><li class="chapter-item expanded affix "><li class="part-title">Core book</li><li class="chapter-item expanded "><a href="content/chapter_1/0_introduction_to_hpc.html"><strong aria-hidden="true">1.</strong> Chapter 1: High Performance Computing (HPC)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/chapter_1/1_introduction_to_sigma2.html"><strong aria-hidden="true">1.1.</strong> Introduction to Uninett Sigma2</a></li><li class="chapter-item expanded "><a href="content/chapter_1/2_navigating_in_hpc.html"><strong aria-hidden="true">1.2.</strong> Navigating in Sigma2</a></li><li class="chapter-item expanded "><a href="content/chapter_1/3_job_script.html"><strong aria-hidden="true">1.3.</strong> Job scripts</a></li></ol></li><li class="chapter-item expanded "><a href="content/chapter_2/0_introduction_containers.html"><strong aria-hidden="true">2.</strong> Chapter 2: Containers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/chapter_2/1_singularity.html"><strong aria-hidden="true">2.1.</strong> Walk through Singularity</a></li><li class="chapter-item expanded "><a href="content/chapter_2/2_using_singularity.html"><strong aria-hidden="true">2.2.</strong> Using Singularity</a></li></ol></li><li class="chapter-item expanded "><a href="content/chapter_3/0_introduction.html"><strong aria-hidden="true">3.</strong> Chapter 3: File management on HPC clusters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/chapter_3/1_copying.html"><strong aria-hidden="true">3.1.</strong> Copying files over to HPC clusters</a></li><li class="chapter-item expanded "><a href="content/chapter_3/2_filesystem.html"><strong aria-hidden="true">3.2.</strong> Using filesystem</a></li></ol></li><li class="chapter-item expanded "><a href="content/chapter_4_Templates.html"><strong aria-hidden="true">4.</strong> Chapter 4: Template</a></li><li class="chapter-item expanded "><a href="content/chapter_5/0_introduction.html"><strong aria-hidden="true">5.</strong> Chapter 5: Advanced topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/chapter_5/1_ray_tune.html"><strong aria-hidden="true">5.1.</strong> Ray tune</a></li></ol></li><li class="chapter-item expanded "><a href="content/acknowledgments.html"><strong aria-hidden="true">6.</strong> Aknowledgments</a></li><li class="chapter-item expanded affix "><li class="part-title">Vocabulary</li><li class="chapter-item expanded "><a href="content/Acronyms.html"><strong aria-hidden="true">7.</strong> List of acronyns</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Appendix A: list of referenced softwares & services</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation on using HPC and containers for Machine Learning</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NINAnor/91126800_ML_and_associated_tech" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This document is a guide to get started with High Performance Computer clusters (HPCC) and more particularly <a href="https://www.sigma2.no/high-performance-computing">Uninett Sigma2's HPCC</a>. This guide aims at understanding the basic commands for navigating in the terminal of an HPCC, at helping running a <strong>job script</strong> and at managing files such as copying files from your local directory to the HPCC and using files that are stored remotely.</p>
<p>This document is the result of a Strategic Funding given by the <a href="https://www.nina.no/english/home">Norwegian Institute for Nature Research</a> (NINA). Please note that the document is <strong>not static</strong> and constantly subject to improvement based on feedbacks. You can contribute to improving the document by opening issues on the <a href="https://github.com/NINAnor/91126800_ML_and_associated_tech">GitHub repository</a> of this project.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-hpc-and-why-using-it"><a class="header" href="#what-is-hpc-and-why-using-it">What is HPC and why using it?</a></h1>
<p><strong>High performance computing</strong> (HPC) generally refers to processing complex calculations at high speeds across multiple servers in parallel. Those groups of servers are known as clusters and are composed of <strong>hundreds or even thousands of compute servers</strong> that have been connected through a network. </p>
<p>With the increased use of technologies like the Internet of Things (IoT), artificial intelligence (AI), and machine learning (ML), organizations are producing huge quantities of data, and they need to be able to process and use that data more quickly in real-time. To power the analysis of such large dataset it is often more practical / mandatory to make use of supercomputing. Supercomputing enables fast processing of data and training of complex algorithms such as neural networks for image and sound recognition.</p>
<h2 id="basic-vocabulary"><a class="header" href="#basic-vocabulary">Basic vocabulary</a></h2>
<h3 id="cluster"><a class="header" href="#cluster">Cluster</a></h3>
<p>An HPC cluster is a <strong>collection of many separate servers (computers)</strong>, called nodes, which are connected via a fast interconnect.</p>
<h3 id="node"><a class="header" href="#node">Node</a></h3>
<p>HPC clusters are composed of:</p>
<ul>
<li>a <strong>headnode</strong>, where users log in</li>
<li>a specialized data transfer node</li>
<li>regular compute nodes (where majority of computations is run)</li>
<li>GPU nodes (on these nodes computations can be run both on CPU cores and on a Graphical Processing Unit)</li>
</ul>
<p><strong>All cluster nodes have the same components as a laptop or desktop</strong>: CPU cores, memory and disk space. The difference between personal computer and a cluster node is in <strong>quantity, quality and power of the components</strong>.</p>
<h3 id="synthesis"><a class="header" href="#synthesis">Synthesis</a></h3>
<pre class="mermaid">graph TB;

G[User] --&gt; |ssh| A

subgraph HPC

subgraph Cluster one
A[headnode 1] --&gt; B[Worker node 1]
A --&gt; C[Worker node 2]
end

subgraph Cluster two
D[headnode 2] --&gt; E[Worker node 1]
D --&gt; F[Worker node 2]
end

end



</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-uninett-sigma2"><a class="header" href="#what-is-uninett-sigma2">What is Uninett Sigma2?</a></h1>
<p>Sigma2 is a <strong>non-profit</strong> company that provides services for high-performance computing and data storage to individuals and groups involved in research and education at all Norwegian universities and colleges, and other publicly funded organizations and projects (such as NINA). Their activities are financed by the <strong>Research Council of Norway (RCN)</strong> and the <strong>Sigma2 consortium partners</strong>, which are the universities in Oslo, Bergen, Trondheim and Tromsø. This collaboration goes by the name <strong>NRIS – Norwegian research infrastructure services</strong>. </p>
<p>Sigma2 owns <strong>four High Performance Computing (HPC) servers</strong> that have different configurations: <code>Betsy</code>, <code>Saga</code>, <code>Fram</code> and <code>LUMI</code>. Generally, if a project requires access to one or more <strong>Graphics processing units</strong> (GPUs) it is reasonable to apply for an access to <code>Saga</code>.</p>
<p>To apply for access to one of Sigma2 HPC please refer to <a href="https://www.sigma2.no/apply-e-infrastructure-resources">this page</a>. You will need to fill out a form describing your project, your experience with HPC and your computational needs (amount of CPU / GPU memory and storage your project will need).</p>
<p>For help regarding the application process contact <a href="mailto:benjamin.cretois@nina.no">Benjamin Cretois</a>, <a href="mailto:kjetil.grun@nina.no">Kjetil Grun</a> or <a href="mailto:francesco.frassinelli@nina.no">Francesco Frassinelli</a>.</p>
<h1 id="getting-started-with-sigma2"><a class="header" href="#getting-started-with-sigma2">Getting started with Sigma2</a></h1>
<p>After a successful application to an account on Sigma2 you will be given your <strong>username</strong> and will be able to log on the HPC terminal.</p>
<p>To access the HPC server you applied for (in our case it is <code>saga</code>). You can log in using the command <code>ssh</code> in <strong>Windows PowerShell</strong> or on a <strong>linux terminal</strong>: </p>
<pre><code class="language-bash">$ ssh username@saga.sigma2.no
</code></pre>
<p>The first time you log in, you will be asked to set your <strong>password</strong> which will have to be used at any subsequent connection to the HPC server.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navigating-in-sigma2s-hpc-server"><a class="header" href="#navigating-in-sigma2s-hpc-server">Navigating in Sigma2's HPC server</a></h1>
<h2 id="basic-bash-commands"><a class="header" href="#basic-bash-commands">Basic bash commands</a></h2>
<p>Communication between you and the HPC server is usually done through an interface named a <code>bash</code> and no <strong>Graphical User Interface (GUI)</strong> is provided</p>
<p>Here is how the bash looks like</p>
<pre><code>[bencretois@login-5.SAGA ~]$ 
</code></pre>
<p>Communicating with a bash requires learning a particular programming language, <strong>bash scripting</strong>. Below we provide a list of selected commands that will allow you to navigate in HPC server:</p>
<h3 id="change-directory"><a class="header" href="#change-directory">Change directory</a></h3>
<p><strong>Command:</strong></p>
<ul>
<li><code>cd + path to the directory</code> </li>
</ul>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~]$ cd deepexperiments/
[bencretois@login-5.SAGA ~/deepexperiments]$
</code></pre>
<h3 id="get-to-the-previous-directory"><a class="header" href="#get-to-the-previous-directory">Get to the previous directory</a></h3>
<p><strong>Command:</strong></p>
<ul>
<li><code>cd ..</code> -&gt; get to the previous directory</li>
</ul>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~/deepexperiments]$ cd ..
[bencretois@login-5.SAGA ~]$
</code></pre>
<h3 id="list-the-content-of-a-directory"><a class="header" href="#list-the-content-of-a-directory">List the content of a directory</a></h3>
<p><strong>Command:</strong></p>
<ul>
<li><code>ls</code> + name of a directory - Note that <code>ls</code> by default list the files of your current directory </li>
</ul>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~/deepexperiments]$ ls

bash_cheatsheet.md   Dockerfile             list_ignore.txt  poetry.lock     runs            sync.sh
bayesianfy.ipynb     docker_run_jupyter.sh  models           pyproject.toml  scripts         utils
deepexperiments.sif  jobs
</code></pre>
<h3 id="get-the-path-of-your-current-directory"><a class="header" href="#get-the-path-of-your-current-directory">get the path of your current directory</a></h3>
<p><strong>Command:</strong></p>
<ul>
<li><code>pwd</code> </li>
</ul>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~]$ pwd
/cluster/home/bencretois
</code></pre>
<h3 id="create-a-new-folder"><a class="header" href="#create-a-new-folder">Create a new folder</a></h3>
<p><strong>Command:</strong></p>
<ul>
<li><code>mkdir</code> + name of the folder you want to create</li>
</ul>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~]$ mkdir new_folder
[bencretois@login-5.SAGA ~]$ ls
deepexperiments new_folder
</code></pre>
<h3 id="learning-more-bash-commands"><a class="header" href="#learning-more-bash-commands">Learning more bash commands</a></h3>
<p><em>Bash command</em>* are very well documented on Internet and if you wish to learn more you can begin <a href="https://www.educative.io/blog/bash-shell-command-cheat-sheet">here</a>.</p>
<h2 id="bash-commands-specific-to-sigma2s-hpc"><a class="header" href="#bash-commands-specific-to-sigma2s-hpc">Bash commands specific to Sigma2's HPC</a></h2>
<p>There are also some useful commands specific to your Sigma2 account:</p>
<h3 id="list-your-projects"><a class="header" href="#list-your-projects">List your projects</a></h3>
<p><strong>Command:</strong></p>
<p><code>projects</code> -&gt; list your projects</p>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~]$ projects
nn5019k
</code></pre>
<h3 id="look-at-used-space-and-allocated-quota-for-your-projects"><a class="header" href="#look-at-used-space-and-allocated-quota-for-your-projects">Look at used space and allocated quota for your projects</a></h3>
<p><strong>Command:</strong></p>
<p><code>dusage</code> -&gt; . Note that <strong>space used</strong> is what you are currently using and <strong>quota</strong> is the limit. </p>
<p><strong>Output:</strong></p>
<pre><code>[bencretois@login-5.SAGA ~]$ dusage

dusage v0.1.4
                          path    backup    space used     quota    files      quota
------------------------------  --------  ------------  --------  -------  ---------
                      /cluster        no       5.6 GiB         -   38 819          -
      /cluster/home/bencretois       yes       4.6 GiB  20.0 GiB    1 311    100 000
/cluster/work/users/bencretois        no       0.0 KiB         -        0          -
     /cluster/projects/nn5019k       yes     938.2 MiB   1.0 TiB   37 508  1 000 000

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="job-script-basics"><a class="header" href="#job-script-basics">Job script basics</a></h1>
<p>To run a job on the cluster involves creating a shell script called a <strong>job script</strong>. The job script is a plain-text file containing any number of commands, including your main computational task.</p>
<h2 id="anatomy-of-a-job-script"><a class="header" href="#anatomy-of-a-job-script">Anatomy of a job script</a></h2>
<p>A job script consists of a couple of parts, in this order:</p>
<ul>
<li>The first line, which is typically <code>#!/bin/bash</code> (the Slurm script does not have to be written in Bash, see below)</li>
<li>Parameters to the queue system (specified using the tag <code>#SBATCH</code>)</li>
<li>Commands to set up the execution environment</li>
<li>The actual commands you want to be run</li>
</ul>
<p>Note that lines starting with a <code>#</code> are ignored as comments, except lines that start with <code>#SBATCH</code> and the <strong>shebang</strong> (i.e. <code>#!/bin/bash</code>), which are not executed, but contain special instructions to the queue system. There can be as many <code>#SBATCH</code> as you want. Moreover, the <code>#SBATCH</code> lines must precede any commands in the script.</p>
<h3 id="sbatch-parameters"><a class="header" href="#sbatch-parameters">SBATCH parameters</a></h3>
<p>Which parameters are allowed or required depends the job type and cluster, but two parameters must be present in (almost) any job:</p>
<ul>
<li><strong>--account</strong>: specifies the project the job will run in. Required by all jobs.</li>
<li><strong>--time</strong>: specifies how long a job should be allowed to run. If it has not finished within that time, it will be cancelled.</li>
</ul>
<p>Other parameters that you will use on HPCs such as <code>SAGA</code>, <code>Betzy</code> or <code>Fram</code> include:</p>
<ul>
<li><strong>ntasks</strong>: specifies the number of tasks to run on a node</li>
<li><strong>cpus-per-task</strong>: allocate a specific number of CPUs to each task</li>
<li><strong>--mem-per-cpu</strong>: allocate a specific amount of memory per CPU and per task</li>
<li><strong>--partition</strong>: </li>
</ul>
<p>And more rarely (if you have a very expensive task to run):</p>
<ul>
<li><strong>--nodes</strong>: number of nodes required</li>
<li><strong>--ntasks-per-node</strong>: number of processes or tasks to run on a single node</li>
</ul>
<h3 id="module-load"><a class="header" href="#module-load">Module load</a></h3>
<p>The <strong>module system</strong> is a concept available on most supercomputers, simplifying the use of different software (versions) in a precise and controlled manner. In most cases, an HPC has far more software installed than the average user will ever use and it would not been computationally efficient to have them loaded by default.</p>
<p>Note that with the use of container, you do not need the module system as all the different softwares should be built in your image. See <a href="content/chapter_1/./chapter_2/0_introduction_containers.html">Chapter 2</a>.</p>
<p>To get a list of available packages you can use:</p>
<pre><code>module avail
</code></pre>
<p>To load a module into your environment to start using an application you can use:</p>
<pre><code>module load package
</code></pre>
<p>For instance, if you want to load <code>Pytorch v. 1.4.0</code> with <code>python 3.7.4</code> use:</p>
<pre><code>PyTorch/1.4.0-fosscuda-2019b-Python-3.7.4
</code></pre>
<h2 id="example-1"><a class="header" href="#example-1">Example 1:</a></h2>
<pre><code class="language-bash">#SBATCH --account=nnXXX
#SBATCH --job-name=Run_ML_model
#SBATCH --nodes=2
#SBATCH --time=1:0:0
#SBATCH --mem-per-cpu=4G
#SBATCH --ntasks=8 --cpus-per-task=10 --ntasks-per-node=4
</code></pre>
<p>This job will get 2 nodes, and run 4 processes (tasks) on each of them, each process is getting 10 cpus with 4GB of memory. The wall-time is 1 hours so each task will be able to compute for a maximum of 1 hour.</p>
<h2 id="example-3-a-generic-script"><a class="header" href="#example-3-a-generic-script">Example 3, a generic script:</a></h2>
<pre><code class="language-bash">
#!/bin/bash

# Job name:
#SBATCH --job-name=YourJobname
#
# Project:
#SBATCH --account=nnXXXXk
#
# Wall time limit:
#SBATCH --time=DD-HH:MM:SS
#
# Other parameters:
#SBATCH ...

## Set up job environment:
set -o errexit  # Exit the script on any error
set -o nounset  # Treat any unset variables as an error

module --quiet purge  # Reset the modules to the system default
module load SomeProgram/SomeVersion
module list

## Do some work:
YourCommands



</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="container-technology"><a class="header" href="#container-technology">Container technology</a></h1>
<p>A container is a standard unit of software that packages up code and all its dependencies so the application runs quickly and reliably from one computing environment to another. <sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>Containers are a solution to the problem of how to get software to run reliably when moved from one computing environment to another. For example, containers can be used to export the training of a ML model from your local machine to a HPC server without the strain of installing all the dependancies necessary to run the training. Think of a container as a shipping container for software — it holds important content like files and programs so that an application can be delivered efficiently from producer to consumer.</p>
<p>To create and use <em>containers</em> the use of a <em>container platform</em> is necessary. <strong>Docker</strong> is the most popular but others exist such as <a href="https://podman.io/">podman</a>. On the other hand, <strong>Docker</strong> and similar have some limitations which makes it difficult to use on HPC clusters and more powerful platform such as <a href="https://docs.sylabs.io/guides/3.5/user-guide/introduction.html">Singularity</a> are necessary.</p>
<p>Since this document focus primarily on using HPC we will go through <strong>Singularity</strong> in more details.</p>
<h2 id="docker"><a class="header" href="#docker">Docker</a></h2>
<p>Docker, a subset of the Moby project, is a software framework for building, running, and managing containers on servers and the cloud. </p>
<h2 id="singularity"><a class="header" href="#singularity">Singularity</a></h2>
<p>Singularity was created to <strong>run complex applications on HPC clusters</strong> in a simple, portable, and reproducible way. First developed at <strong>Lawrence Berkeley National Laboratory</strong>, it quickly became popular at other HPC sites, academic sites, and beyond. Singularity is an open-source project, with a friendly community of developers and users. The user base continues to expand, with Singularity now used across industry and academia in many areas of work.</p>
<h2 id="images"><a class="header" href="#images">Images</a></h2>
<h3 id="image-versus-container"><a class="header" href="#image-versus-container">Image versus container</a></h3>
<p>A container is a <strong>virtualized runtime environment used in application development</strong>. It is used to create, run and deploy applications that are isolated from the underlying hardware. A container can use one machine, share its kernel and virtualize the OS to run more isolated processes. As a result, containers are lightweight.</p>
<p>An image is <strong>like a snapshot in other types of VM environments</strong>. It is a record of a Docker container at a specific point in time. Docker images are also immutable. While they can't be changed, they can be duplicated, shared or deleted. The feature is useful for testing new software or configurations because whatever happens, the image remains unchanged.</p>
<p><strong>Containers need a runnable image to exist</strong>. Containers are dependent on images, because they are used to construct runtime environments and are needed to run an application. <sup class="footnote-reference"><a href="#2">2</a></sup></p>
<pre class="mermaid">
graph LR;

A[Image] --&gt; B[Container A]
A[Image] --&gt; C[Container B]
A[Image] --&gt; D[Container C]

</pre>
<p><em>Figure X: The image is a single file with all the dependancies and configurations to run a program. Containers are instances of an image.</em></p>
<h3 id="image-registry"><a class="header" href="#image-registry">Image registry</a></h3>
<p>The Registry is a stateless, highly scalable server side application that stores and lets you <strong>distribute Docker images</strong>. Registries can be private, for instance some institutes or companies have internal registries to share images amongst teams but it is also possible to share images on <strong>public</strong> registries such as <a href="https://hub.docker.com/">Docker Hub</a>, <a href="https://docs.gitlab.com/ee/user/packages/container_registry/">GitLab registry</a> or the <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry">GitHub registry</a>.</p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Definition from <a href="https://www.docker.com/resources/what-container/">docker.com</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>Definition from <a href="https://www.techtarget.com/searchitoperations/definition/Docker-image">techtarget.com</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="singularity-1"><a class="header" href="#singularity-1">Singularity</a></h1>
<p>Singularity is a <strong>container platform</strong>. It allows you to create and run containers that package up pieces of software in a way that is portable and reproducible. You can build a container using Singularity on your laptop, and then run it on many of the largest HPC clusters in the world, local university or company clusters, a single server, in the cloud, or on a workstation down the hall. </p>
<h2 id="singularity-image-format-file"><a class="header" href="#singularity-image-format-file">Singularity Image Format file</a></h2>
<p><strong>Singularity</strong> uses <strong>Singularity Image Format</strong> (<code>.sif</code>) files to run containers. <code>sif</code> files can be built through two processes:</p>
<ul>
<li>Downloading pre-built images</li>
<li>Building images from scratch</li>
</ul>
<p>Building images from scratch require <strong>root access</strong> and since we do not have <strong>root access</strong> at NINA we need to rely on downloading pre-built images to build our <code>.sif</code> files.</p>
<h2 id="downloading-pre-built-images-as-sif-files"><a class="header" href="#downloading-pre-built-images-as-sif-files">Downloading pre-built images as <code>.sif</code> files</a></h2>
<p>It is possible to download images from the public image registries using <strong>Singularity</strong> using <code>singularity pull</code>. For instance, you can pull the <a href="https://hub.docker.com/_/python">latest official python image from docker hub</a> on saga using the command:</p>
<pre><code>singularity pull docker://python
</code></pre>
<p>The <code>docker://</code> uri is used to reference Docker images served from a registry. In this case <code>pull</code> does not just download an image file. Docker images are stored in layers, so <code>pull</code> combines those layers into a usable <strong>Singularity file</strong>.</p>
<p>I make sure that the images has been pulled:</p>
<pre><code>[bencretois@login-1.SAGA ~]$ ls
python_latest.sif
</code></pre>
<h2 id="downloading-your-own-custom-image"><a class="header" href="#downloading-your-own-custom-image">Downloading your own custom image</a></h2>
<p>In most case you will want to use <strong>an image that you built</strong> so that the depencies required to run your custom software are already specified and installed. Since we do not have <strong>root access</strong> at NINA we follow the following workflow:</p>
<ol>
<li>Specify a <code>Dockerfile</code></li>
<li>Build the docker image</li>
<li>Push the docker image in a registry</li>
<li>Pull the image as a <code>.sif</code> file from a HPC cluster</li>
</ol>
<p>Below we describe and provide an example for each step.</p>
<h3 id="1-specify-a-dockerfile"><a class="header" href="#1-specify-a-dockerfile">1. Specify a <code>Dockerfile</code></a></h3>
<p>We first write a <code>Dockerfile</code> containing all we need to run our software. In this case, we want to train a cat and dog picture classifier and we need to write the <code>Dockerfile</code> accordingly.</p>
<pre><code>FROM python:3.8

ARG DEBIAN_FRONTEND=noninteractive

RUN pip3 install poetry 

WORKDIR /app
COPY pyproject.toml poetry.lock ./

RUN poetry config virtualenvs.create false
RUN poetry install --no-root

COPY . ./

ENV PYTHONPATH &quot;${PYTHONPATH}:/app/&quot;
</code></pre>
<p>In this <code>Dockerfile</code> we first use the official image for python.3.8. </p>
<p>Then we install <a href="https://python-poetry.org/">poetry</a> (which is the python package manager) using <code>pip</code>. We recommand <strong>poetry</strong> over <strong>anaconda</strong> as we ran into some problems running <strong>anaconda</strong> with Docker. </p>
<p>We set the working directory of the container as <code>/app</code></p>
<p>We copy both <code>pyproject.toml</code> and <code>poetry.lock</code> in the container so that <code>poetry</code> knows which packages to install</p>
<p>We install the packages necessary to run our machine learning experiment</p>
<p>And finally we specify the <code>PYTHONPATH</code> so that scripts that are in certain folders can read the scripts which are stored in other folders.</p>
<h3 id="2-build-the-docker-image"><a class="header" href="#2-build-the-docker-image">2. Build the docker image</a></h3>
<p>Building the docker image implies that <code>docker</code> is installed on your system. At NINA it is possible to install <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> to use Docker on the remote server. Please contact Datahjelp which can assist you setting up either <strong>Docker Desktop</strong> or the <strong>VDI</strong> .</p>
<p>Once you have access to <code>docker</code> you can build your custom image using the command:</p>
<p><code>docker build -t ml_image -f Dockerfile .</code></p>
<p><code>-t</code> stands for &quot;tag&quot;, which is the name you want to give to the image.</p>
<p><code>-f</code> stands for &quot;file&quot; and takes the <code>Dockerfile</code> as input.</p>
<h3 id="3-push-the-docker-image-in-a-registry"><a class="header" href="#3-push-the-docker-image-in-a-registry">3. Push the docker image in a registry</a></h3>
<p>It is possible to push your custom image directly in the <strong>GitLab</strong> or <strong>GitHub</strong> registry. </p>
<h4 id="pushing-the-image-on-gitlab-registry"><a class="header" href="#pushing-the-image-on-gitlab-registry">Pushing the image on GitLab registry</a></h4>
<p>Pushing the image on the <strong>Gitlab</strong> registry requires less manual configuration and we give an example on how to do it below.</p>
<p>Provided that you have a GitLab account and a GitLab project (in our example the project is called <code>ml_image</code>) for your specific task, the image should be rename as:</p>
<pre><code>registry.gitlab.com/nina-data/ml_image:latest
</code></pre>
<p>We rename the image to provide an url to the registry where the image should be stored. Once the image has been pushed, you can check <code>GitLab project -&gt; Container registry</code></p>
<h4 id="pushing-the-image-on-github-registry"><a class="header" href="#pushing-the-image-on-github-registry">Pushing the image on GitHub registry</a></h4>
<p>In your project repository create a folder <code>.github/workflows</code> and create a file <code>publish_image.yml</code> containing the following code:</p>
<pre><code>name: Create and publish a Docker image

on:
  push:
    branches: main

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build-and-push-image:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Log in to the Container registry
        uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}

      - name: Build and push Docker image
        uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
</code></pre>
<p>Once the folder and file have been created simply <strong>push</strong> the <code>.github</code> to the project's GitHub repository and <strong>GitHub Actions</strong> will take care of building and hosting the image.</p>
<p>Note that you will find the image in <code>Packages</code> (right sidebar of GitHub) and that you will need to make your image <strong>public</strong> before being able to pull it on <strong>Sigma2</strong>.</p>
<h3 id="4-pull-the-image-as-a-sif-file-from-a-hpc-cluster"><a class="header" href="#4-pull-the-image-as-a-sif-file-from-a-hpc-cluster">4. Pull the image as a <code>.sif</code> file from a HPC cluster</a></h3>
<p>To pull the image that is stored on Gitlab, Docker hub or GitHub registry simply run:</p>
<pre><code>singularity pull docker://registry/name_of_your_image
</code></pre>
<p>For instance, to pull the image from this repository (which is hosted on GitHub):</p>
<pre><code> singularity pull docker://ghcr.io/ninanor/91126800_ml_and_associated_tech:main
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="interact-with-images"><a class="header" href="#interact-with-images">Interact with images</a></h1>
<p>Now that the <code>.sif</code> file has been <strong>pulled</strong>, it is possible to interact with it via multiple ways.</p>
<h2 id="shell"><a class="header" href="#shell">Shell</a></h2>
<p>The <code>shell</code> command allows you to spawn a new bash <strong>within your container</strong> and interact with it as though it were a small virtual machine.</p>
<pre><code>[bencretois@login-1.SAGA ~]$ singularity shell 91126800_ml_and_associated_tech_main.sif
Singularity&gt;
</code></pre>
<p>The change in prompt indicates that you have entered the container. Once inside of a Singularity container, you are the same user as you are on the host system <strong>except that you have root access, meaning that you can install packages and other software in your container</strong>.</p>
<p>Note that with <strong>singularity</strong>, when you are inside of a Singularity container, you are the same user as you are on the host system.</p>
<pre><code>Singularity&gt; whoami
bencretois
</code></pre>
<h2 id="executing-commands"><a class="header" href="#executing-commands">Executing commands</a></h2>
<p>The <code>exec</code> command allows you to execute a custom command within a container by specifying the image file. For instance, if I want to train a Machine Learning model using the <code>.sif</code> image we could write:</p>
<pre><code>singularity exec \
                91126800_ml_and_associated_tech_main.sif \
                python main_scripts/train_model.py
</code></pre>
<h2 id="specifying-bind-paths"><a class="header" href="#specifying-bind-paths">Specifying bind paths</a></h2>
<p>If the data we want to process / use to train a machine learning model are stored in a different folder (for instance our <code>.sif</code> file is in <code>cluster/projects/nn8055k</code> but the data is in <code>cluster/projects/nn8054k</code>) we need to expose <code>cluster/projects/nn8054k</code> or in other words, make it available to the container. The flag <code>--bind</code> fill that purpose. </p>
<p>We would run the container as follow:</p>
<pre><code>singularity exec \
                --bind /cluster/projects/nn8054k \
                91126800_ml_and_associated_tech_main.sif \
                python main_scripts/train_model.py
</code></pre>
<h2 id="exposing-gpus"><a class="header" href="#exposing-gpus">Exposing GPUs</a></h2>
<p>When training or using a machine learning model it will usually be preferable to use a GPU(s) for accelerating the processed. The container being an &quot;isolated&quot; environment, it is required to specify that we want to expose GPUs to our container. This can simply be done by adding the flag <code>--nv</code>. For example:</p>
<pre><code>singularity exec \
                --nv \
                91126800_ml_and_associated_tech_main.sif \
                python main_scripts/train_model.py
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="file-management-on-hpc-clusters"><a class="header" href="#file-management-on-hpc-clusters">File management on HPC clusters</a></h1>
<p>In addition to training a machine learning model we usually want to process our data on an HPC cluster to benefit the computational resources. For example, if we want to train a complex machine learning model we want the HPC cluster to first process our data so we get <strong>tensors</strong> so they can be used as inputs for the model. <strong>Using the data requires being able to access them</strong>.</p>
<p>There are two ways of making the data available to the HPC cluster:</p>
<ol>
<li>Copying the data over to the HPC cluster</li>
<li>Using a <strong>filesystem</strong> to make remote data available to the HPC cluster</li>
</ol>
<h2 id="copying-the-data-over-to-the-hpc-cluster"><a class="header" href="#copying-the-data-over-to-the-hpc-cluster">Copying the data over to the HPC cluster</a></h2>
<p>Both methods have their advantages and drawbacks. While copying data over to the HPC cluster is conceptually simpler as it doesn't require the use of any specific library, the method will be limited by the size of the dataset. By default, if you apply for an account on one of Sigma2's HPC clusters you will be allocated <strong>1 TB</strong> of storage that can be extended up to <strong>10TB</strong>. Moreover, copying multiple TB of data can be a <strong>long process</strong>.</p>
<h2 id="using-a-filesystem-to-make-remote-data-available-to-the-hpc-cluster"><a class="header" href="#using-a-filesystem-to-make-remote-data-available-to-the-hpc-cluster">Using a <strong>filesystem</strong> to make remote data available to the HPC cluster</a></h2>
<p>On the other hand, using <strong>filesystems</strong> allows you to use data stored in a remote server (e.g. cloud storage, private servers ...) in the HPC cluster and abstract the need of having storage memory in the HPC cluster. <strong>Filesystems</strong> nevertheless require slight change in your code.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="copying-files-over-to-an-hpc-cluster"><a class="header" href="#copying-files-over-to-an-hpc-cluster">Copying files over to an HPC cluster</a></h1>
<p>It is possible to copy / transfer files using simple <strong>bash</strong> commands. <code>scp</code> is used to simply <strong>copy</strong> data over while <code>rsync</code> is used to <strong>synchronise</strong> folders.</p>
<h2 id="scp-copying-files"><a class="header" href="#scp-copying-files"><code>scp</code>: Copying files</a></h2>
<p>The first command  is <code>scp</code> which allows you to copy files from your machine to the HPC machines. For instance you want to copy the script <code>train_model.py</code> from the <strong>template</strong> folder over to <code>saga</code> in the project folder <strong>nn8055k</strong>, we would write (using your relevant username and HPC):</p>
<pre><code>$ scp train_model.py bencretois@saga.sigma2.no:/cluster/projects/nn8055k/
</code></pre>
<p>With <code>scp</code> it is also possible to <strong>copy a folder</strong> over to the HPC machine, you will need to add the flag <code>-r</code> for this. For instance, if I want to copy the entire <code>template</code> folder over to <code>saga</code> I can write:</p>
<pre><code>$ scp -r template bencretois@saga.sigma2.no:/cluter/projects/nn8055k
</code></pre>
<h2 id="rsync-synchronizing-a-local-repository-with-a-remote-repository"><a class="header" href="#rsync-synchronizing-a-local-repository-with-a-remote-repository"><code>rsync</code>: Synchronizing a local repository with a remote repository</a></h2>
<p>Instead of copying all files from your local to remote folder you can synchronze the two folders with <code>rsync</code>. Synchronizing has the advantage of being more flexible than <code>scp</code> and has some optimisations to make the transfer of files faster. Moreoever <code>rsync</code> has a plethora of command line options, allowing the user to fine tune its behavior. It supports complex filter rules, runs in batch mode, daemon mode, etc. </p>
<pre><code>$ rsync -e ssh -avz ./local_repo user@server:/remote_repo
</code></pre>
<p><code>-a</code> is the archive option, i.e. syncs directories recursively while keeping permissions, symbolic links, ownership, and group settings. </p>
<p><code>-v</code> being the verbose option and prints the progress and status of the rsync command.</p>
<p><code>-z</code> compressing files during the transfer - speed up the sync.</p>
<p><code>-e</code> is used to specify the remote shell to use, <code>ssh</code> in our case.</p>
<p>It is also possible to use the option <code>--exclude</code> to exclude some file from synchronisation:</p>
<pre><code>$ rsync -e ssh -avz --exclude &quot;file.txt&quot; ./local_repo user@server:/remote_repo
</code></pre>
<p>However, in some cases there are files that we do not want to send to the remote repository. In these cases with can generate and <code>.txt</code> file containing a list of files to exclude.</p>
<pre><code>$ rsync -e ssh -avz --exclude-from{&quot;list_ignore.txt&quot;} ./local_repo user@server:/remote_repo
</code></pre>
<p>With <code>list_ignore.txt</code> looking like:</p>
<pre><code>folder1
file1.txt
folder2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filesystem"><a class="header" href="#filesystem">Filesystem</a></h1>
<p>A <strong>filesystem</strong> (or filesystem) is the way in which files are named and where they are placed logically for <strong>storage</strong> and <strong>retrieval</strong>. Without a file system, stored information wouldn't be isolated into individual files and would be difficult to identify and retrieve. As data capacities increase, the organization and accessibility of individual files are becoming even more important in data storage. <sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<pre class="mermaid">
graph TB;

A[Project folder] --&gt; B[Camera trap pictures]
A --&gt; C[Code]
A --&gt; D[Report.doc]
B --&gt; E[Pictures of deer]
B --&gt; F[Pictures of birds]
C --&gt; G[myscript.py]
</pre>
<h2 id="pyfilesystem-a-filesystem-abstraction-for-python"><a class="header" href="#pyfilesystem-a-filesystem-abstraction-for-python">Pyfilesystem: a filesystem abstraction for Python</a></h2>
<p>A filesystem abstraction allows you to work with files and directories in archives, memory, the cloud etc. as easily as your local drive. <strong>It makes your code agnostic to where the data is stored</strong>.</p>
<p><strong><a href="https://www.pyfilesystem.org/">Pyfilesystem</a></strong> is a filesystem abstraction <strong>for Python</strong>. This means that in your python code you can fully replace the use of <code>os</code> with <strong>Pyfilesystem</strong>. </p>
<p>Suppose the data is stored on <code>NIRD</code> in the project folder <code>/folder/my_data</code> but I want to process the data on <code>SAGA</code> to benefit from optimal computational resources. To access the data on <code>NIRD</code> I would make the following change to my code:</p>
<p>First, a connection to <code>NIRD</code> must be established. The connection to <code>NIRD</code> is done using the <code>ssh</code> protocol.</p>
<pre><code class="language-python">connection_string = &quot;ssh://bencretois:PASSWORD@nird.sigma2.no&quot;


def doConnection(connection_string):

    myfs = fs.open_fs(connection_string)
    return myfs


my_filesystem = doConnection(connection_string)
</code></pre>
<p>Now that the connection is established we can list the files in <code>/folder/my_data</code>:</p>
<pre><code class="language-python">def walk_audio(filesystem, input_path):
    # Get all files in directory with os.walk
    walker = filesystem.walk(input_path, filter=['*.wav', '*.mp3'])
    for path, dirs, flist in walker:
        for f in flist:
            yield fs.path.combine(path, f.name)


all_files = walk_audio(my_filesystem, &quot;/folder/my_data&quot;)
</code></pre>
<p>Now that the object <code>all_files</code> has been created, it is possible to use the files locally.</p>
<hr />
<p><sup class="footnote-reference"><a href="#1">1</a></sup> Definition on <a href="https://www.techtarget.com/searchstorage/definition/file-system">Techtarget</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-4-template"><a class="header" href="#chapter-4-template">Chapter 4: Template</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-5-advanced-topics"><a class="header" href="#chapter-5-advanced-topics">Chapter 5: Advanced topics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ray-tune"><a class="header" href="#ray-tune">Ray tune</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="acknowlegments"><a class="header" href="#acknowlegments">Acknowlegments</a></h1>
<p>This document would not have been possible without the inputs of Francesco Frassinelli, Kjetil Grun and Stig Clausen.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="list-of-acronyms"><a class="header" href="#list-of-acronyms">List of acronyms</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Acronym</th><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>GPU</td><td>Graphic Processing Unit</td><td>A specialized processor originally designed to accelerate graphics rendering. Used extensively in Machine Learning to train complex algorithms</td></tr>
<tr><td>GUI</td><td>Graphical User Interface</td><td>Form of user interface that allows users to interact with electronic devices through graphical icons and audio indicator such as primary notation</td></tr>
<tr><td>ML</td><td>Machine learning</td><td>Use and development of computer systems that are able to learn and adapt without following explicit instructions</td></tr>
<tr><td>DL</td><td>Deep learning</td><td>Part of the family of machine learning methods based on artificial neural networks with representation learning.</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
