<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Chapter 2: High Performance Computer Clusters (HPCC) - Documentation on using HPC and containers for Machine Learning</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Preliminary comments</a></li><li class="chapter-item expanded affix "><li class="part-title">Core book</li><li class="chapter-item expanded "><a href="../content/chapter_1_hpc.html" class="active"><strong aria-hidden="true">1.</strong> Chapter 2: High Performance Computer Clusters (HPCC)</a></li><li class="chapter-item expanded "><a href="../content/chapter_2_Containers.html"><strong aria-hidden="true">2.</strong> Chapter 3: Containers</a></li><li class="chapter-item expanded "><a href="../content/chapter_3_FileSystem.html"><strong aria-hidden="true">3.</strong> Chapter 4: Data management</a></li><li class="chapter-item expanded "><a href="../content/chapter_4_Templates.html"><strong aria-hidden="true">4.</strong> Chapter 5: Case studies</a></li><li class="chapter-item expanded "><a href="../content/acknowledgments.html"><strong aria-hidden="true">5.</strong> Aknowledgments</a></li><li class="chapter-item expanded affix "><li class="part-title">Vocabulary</li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Glossary of terms and names</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> List of acronyns</div></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Appendix A: list of referenced softwares & services</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation on using HPC and containers for Machine Learning</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="high-performance-clusters-hpc"><a class="header" href="#high-performance-clusters-hpc">High Performance Clusters (HPC)</a></h1>
<h2 id="1-description-of-sigma2-and-how-to-apply-for-an-account"><a class="header" href="#1-description-of-sigma2-and-how-to-apply-for-an-account">1. Description of SIGMA2 and how to apply for an account</a></h2>
<h3 id="11-what-is-sigma2"><a class="header" href="#11-what-is-sigma2">1.1. What is SIGMA2?</a></h3>
<p>Sigma2 is a <strong>non-profit</strong> company that provides services for high-performance computing and data storage to individuals and groups involved in research and education at all Norwegian universities and colleges, and other publicly funded organizations and projects (such as NINA). Their activities are financed by the <strong>Research Council of Norway (RCN)</strong> and the <strong>Sigma2 consortium partners</strong>, which are the universities in Oslo, Bergen, Trondheim and Tromsø. This collaboration goes by the name <strong>NRIS – Norwegian research infrastructure services</strong>. </p>
<p>Sigma2 owns four High Performance Computing (HPC) servers that have different capabilities: <code>Betsy</code>, <code>Saga</code>, <code>Fram</code> and <code>LUMI</code>. Generally, at NINA we do not conduct extremely intensive computational tasks (compared to an AI lab for instance) and if we want access to one or multiple GPUs it is reasonable to apply for an access to <code>Saga</code>.</p>
<p>To apply for access to one of Sigma2 HPC please refer to <a href="https://www.sigma2.no/apply-e-infrastructure-resources">this page</a>. You will need to fill out a form describing your project, your experience with HPC and your computational needs (amount of CPU / GPU memory and storage your project will need).</p>
<p>For some help regarding the application process contact <a href="mailto:benjamin.cretois@nina.no">Benjamin Cretois</a>, <a href="mailto:kjetil.grun@nina.no">Kjetil Grun</a> or <a href="mailto:francesco.frassinelli@nina.no">Francesco Frassinelli</a>.</p>
<h3 id="12-the-role-of-sigma2-in-the-ml-workflow"><a class="header" href="#12-the-role-of-sigma2-in-the-ml-workflow">1.2. The role of Sigma2 in the ML workflow</a></h3>
<p>While most of the scripting for building efficient machine learning pipeline and algorithms is be done locally (on your own NINA laptop or on the Linux Virtual Desktop made available by Datahjelp, VDI), Sigma2 supercomputers can help being more efficient at training / using the machine learning models.</p>
<p>Machine learning algorithms and particularly deep learning algorithms are much faster trained wth Graphical Processing Units (GPUs) as GPUs are very efficient at parallelizing processes. Sigma2's computers have multiple GPUs available that we can &quot;borrow&quot; for our computation tasks - this is specified in a <strong>job</strong> script as we will see later. Sigma2 makes it possible to train multiple ML models at the same time for instance, making it possible to fine tune specific parameters and variables relatively quickly.</p>
<p>Sigma2 should thus be used when our scripts related to machine learning already work on the VDI (or on your local computer) and you would like to fine-tune your model's parameters or ultimately to train your machine learning model on the entire dataset you have.</p>
<h3 id="13-getting-started-with-sigma2"><a class="header" href="#13-getting-started-with-sigma2">1.3. Getting started with Sigma2</a></h3>
<p>After a successful application to an account on Sigma2 you will be able to access the HPC facility you applied for (in our case it is <code>saga</code>). You can log in using the command <code>ssh</code> in Windows PowerShell or on a linux terminal: </p>
<pre><code class="language-bash">$ ssh username@saga.sigma2.no
</code></pre>
<p>Note that if you have access to another HPC facility, you have to replace <code>saga</code> in the command describe above.</p>
<h2 id="2-basic-commands-on-sigma2"><a class="header" href="#2-basic-commands-on-sigma2">2. Basic commands on Sigma2</a></h2>
<h3 id="21-beginner-bash"><a class="header" href="#21-beginner-bash">2.1 Beginner bash</a></h3>
<p>Once you are logged in the HPC you should only see a dry, unwelcoming interface named a <code>shell</code>. Navigating on a computer through a shell can be quite combersome as it works through commands only, there is no real visual apart from the displayed text!</p>
<pre><code># Here is how the shell looks like
[bencretois@login-5.SAGA ~]$ 
</code></pre>
<p>To navigate in the HPC you will need to learn some <code>shell scripting</code>. Here is a quick list of command that will allow you to navigate in a Sigma2 supercomputer:</p>
<ul>
<li><code>cd + path to the directory</code> -&gt; change director</li>
</ul>
<pre><code>[bencretois@login-5.SAGA ~]$ cd deepexperiments/
[bencretois@login-5.SAGA ~/deepexperiments]$
</code></pre>
<ul>
<li><code>ls</code> list the folder (i.e. the directory) in which you are</li>
</ul>
<pre><code>[bencretois@login-5.SAGA ~/deepexperiments]$ ls
bash_cheatsheet.md   Dockerfile             list_ignore.txt  poetry.lock     runs            sync.sh
bayesianfy.ipynb     docker_run_jupyter.sh  models           pyproject.toml  scripts         utils
deepexperiments.sif  jobs
</code></pre>
<ul>
<li><code>cd ..</code> -&gt; get to the previous directory</li>
</ul>
<pre><code>[bencretois@login-5.SAGA ~/deepexperiments]$ cd ..
[bencretois@login-5.SAGA ~]$
</code></pre>
<ul>
<li><code>pwd</code> -&gt; get the path of the current directory</li>
</ul>
<pre><code>[bencretois@login-5.SAGA ~]$ pwd
/cluster/home/bencretois
</code></pre>
<ul>
<li><code>mkdir name_folder</code> -&gt; create a folder named <code>name_folder</code></li>
</ul>
<pre><code>[bencretois@login-5.SAGA ~]$ mkdir new_folder
[bencretois@login-5.SAGA ~]$ ls
deepexperiments new_folder
</code></pre>
<h3 id="22-bash-commands-specific-to-sigma2"><a class="header" href="#22-bash-commands-specific-to-sigma2">2.2. Bash commands specific to Sigma2</a></h3>
<p>There are also some useful commands specific to your Sigma2 account:</p>
<p><code>projects</code> -&gt; list your projects</p>
<pre><code>[bencretois@login-5.SAGA ~]$ projects
nn5019k
</code></pre>
<p><code>dusage</code> -&gt; look at the space used in your project folders. Note that <strong>space used</strong> is what you are currently using and <strong>quota</strong> is the limit. </p>
<pre><code>[bencretois@login-5.SAGA ~]$ dusage

dusage v0.1.4
                          path    backup    space used     quota    files      quota
------------------------------  --------  ------------  --------  -------  ---------
                      /cluster        no       5.6 GiB         -   38 819          -
      /cluster/home/bencretois       yes       4.6 GiB  20.0 GiB    1 311    100 000
/cluster/work/users/bencretois        no       0.0 KiB         -        0          -
     /cluster/projects/nn5019k       yes     938.2 MiB   1.0 TiB   37 508  1 000 000

</code></pre>
<h3 id="3-running-scripts-on-sigma2"><a class="header" href="#3-running-scripts-on-sigma2">3 Running scripts on Sigma2</a></h3>
<h3 id="31-anatomy-of-a-job-script"><a class="header" href="#31-anatomy-of-a-job-script">3.1. Anatomy of a job script</a></h3>
<p>To run a job on a SIGMA2 server we need to create a shell script called a job script. The job script is a plain-text file containing any number of commands, including your main computational task</p>
<h3 id="32-description-of-job-scripts"><a class="header" href="#32-description-of-job-scripts">3.2. Description of job scripts</a></h3>
<h2 id="using-docker-on-sigma2"><a class="header" href="#using-docker-on-sigma2">Using docker on SIGMA2</a></h2>
<ol>
<li>Introduction to docker</li>
<li>Build your custom docker image</li>
<li>Introduction to singularity</li>
<li>Run your script in a docker container</li>
</ol>
<h2 id="machine-learning-workflow"><a class="header" href="#machine-learning-workflow">Machine learning workflow</a></h2>
<ol>
<li>Structuring the ML project</li>
</ol>
<p>First of all, we need to differentiate the <strong>development space</strong> &amp; the <strong>data space</strong>. Usually, HPCs allocate a large amount of disk storage capacity in a specific place (i.e. <code>/cluster/projects/</code> for SAGA) and a smaller amount of disk storage capacity to store the scripts used to run an analysis (i.e. <code>/cluster/home/</code>)</p>
<p>For instance, for this specific project (nn5019k) we have 20GB of space in <code>/cluster/home/bencretois</code> and 1TB in <code>/cluster/projects/nn5019k</code> as displayed with the command <code>dusage</code> below:</p>
<pre><code>[bencretois@login-5.SAGA ~]$ dusage

dusage v0.1.4
                          path    backup    space used     quota    files      quota
------------------------------  --------  ------------  --------  -------  ---------
                      /cluster        no       5.6 GiB         -   38 819          -
      /cluster/home/bencretois       yes       4.6 GiB  20.0 GiB    1 311    100 000
/cluster/work/users/bencretois        no       0.0 KiB         -        0          -
     /cluster/projects/nn5019k       yes     938.2 MiB   1.0 TiB   37 508  1 000 000

</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../content/chapter_2_Containers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../content/chapter_2_Containers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
